(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{272:function(t,s,a){"use strict";a.r(s);var n=a(38),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"module-4-multi-containers-environment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#module-4-multi-containers-environment","aria-hidden":"true"}},[t._v("#")]),t._v(" Module 4: Multi containers environment")]),t._v(" "),a("h3",{attrs:{id:"contact-service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#contact-service","aria-hidden":"true"}},[t._v("#")]),t._v(" Contact service")]),t._v(" "),a("p",[t._v("Contact service is writtern by "),a("code",[t._v(".Net Core 3.0 preview")]),t._v(" and use "),a("code",[t._v("Postgres")]),t._v(" to store data. Source code is ready at "),a("a",{attrs:{href:"https://github.com/tungphuong/crm.git",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/tungphuong/crm.git"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("p",[t._v("To dockerize this service, we need 3 containers:")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("Postgres")])]),t._v(" "),a("li",[a("strong",[t._v("Contact service")])]),t._v(" "),a("li",[a("strong",[t._v("Database migration")])])]),t._v(" "),a("p",[t._v("Let's pull the image")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" docker pull postgres:11-alpine\n")])])]),a("p",[t._v("And run it")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" docker run --rm -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5432")]),t._v(":5432 -d -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("POSTGRES_USER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("lab -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("POSTGRES_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("P@ssw0rd --name postgres.data postgres:11-alpine\n")])])]),a("p",[t._v('Run "Contact" service')]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" docker run --rm -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),t._v(":80 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ConnectionStrings__default")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Server=postgres.data;Port=5432;Database=crm-contact;User Id=lab;Password=P@ssw0rd;"')]),t._v(" crmnow/contact-api:latest\n\nSystem.Net.Internals.SocketExceptionFactory+ExtendedSocketException "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("00000005, 0xFFFDFFFF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": Name or "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" not known\n   at System.Net.Dns.InternalGetHostByName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String hostName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   at System.Net.Dns.ResolveCallback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Object context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n--- End of stack trace from previous location where exception was thrown ---\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Exception "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   at System.Net.Dns.HostResolutionEndHelper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IAsyncResult asyncResult"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   at System.Net.Dns.EndGetHostAddresses"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IAsyncResult asyncResult"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   at System.Net.Dns."),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<>")]),t._v("c."),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("GetHostAddressesAsync"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("b__25_1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IAsyncResult asyncResult"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   at System.Threading.Tasks.TaskFactory"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(".FromAsyncCoreLogic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IAsyncResult iar, Func"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" endFunction, Action"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" endAction, Task"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" promise, Boolean requiresSynchronization"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n--- End of stack trace from previous location where exception was thrown ---\n")])])]),a("p",[t._v('The service cannot connect to database. So, how to connect them together. The answer relates to "Docker Network".')]),t._v(" "),a("h3",{attrs:{id:"docker-network"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-network","aria-hidden":"true"}},[t._v("#")]),t._v(" Docker network")]),t._v(" "),a("p",[t._v("Create our own netwrok")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" docker network create workshop-network\n1de671cb3e7b3c05679c4f4a59bb75c5856f491008d44f24b57638523c40f9f6\n")])])]),a("p",[t._v("Next, we will run Postgres in the new network")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" docker run --rm -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5432")]),t._v(":5432 -d -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("POSTGRES_USER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("lab -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("POSTGRES_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("P@ssw0rd --name postgres.data --net workshop-network  postgres:11-alpine\n")])])]),a("p",[t._v("And try to connect our service to database server in the "),a("code",[t._v("workshop-network")]),t._v(" network")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" docker run --rm -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),t._v(":80 --net workshop-network -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ConnectionStrings__default")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Server=postgres.data;Port=5432;Database=crm-contact;User Id=lab;Password=P@ssw0rd;"')]),t._v(" crmnow/contact-api:latest\n\nNpgsql.PostgresException "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0x80004005"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": 3D000: database "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"crm-contact"')]),t._v(" does not exist\n   at Npgsql.NpgsqlConnector."),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<>")]),t._v("c__DisplayClass161_0."),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v("ReadMessage"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("g__ReadMessageLong"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("0")]),t._v(">")]),t._v("d.MoveNext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("Greate, connected successfully but we still need to setup database via migration.")]),t._v(" "),a("h3",{attrs:{id:"docker-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose","aria-hidden":"true"}},[t._v("#")]),t._v(" Docker compose")]),t._v(" "),a("p",[t._v("Docker compose is a tool for defining and running multi-container Docker application")]),t._v(" "),a("p",[t._v("Install "),a("code",[t._v("compose-compose")]),t._v(" CLI")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -L "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://github.com/docker/compose/releases/download/1.24.1/docker-compose-'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uname")]),t._v(" -s"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uname")]),t._v(" -m"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v('"')]),t._v(" -o /usr/local/bin/docker-compose\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" +x /usr/local/bin/docker-compose\n")])])]),a("p",[t._v("Test the installation")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ docker-compose --version\n$ docker-compose version "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.24")]),t._v(".1, build 4667896b\n")])])]),a("p",[t._v("Next steps, expoler one simple Docker compose file with YAML format.")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.7'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("postgres.data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("11"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alpine\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/postgresql/data\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" crm\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("contact-api")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("REGISTRY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("crmnow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/contact"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("TAG"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" .\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dockerfile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" src/Contact/CRM.Contact.Api/Dockerfile\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" feed=$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("NUGET_FEED"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('source "https'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v('//api.nuget.org/v3/index.json"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" crm\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" postgres.data\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("contact-api-migration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("REGISTRY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("crmnow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/contact"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("TAG"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" .\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dockerfile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" src/Contact/CRM.Contact.Api/Dockerfile\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("target")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" migration\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" feed=$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("NUGET_FEED"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('source "https'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v('//api.nuget.org/v3/index.json"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ConnectionStrings__contact=Server=postgres.data;Port=5432;Database=crm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("contact;User Id=lab;Password=P@ssw0rd;\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("entrypoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" dotnet\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" run\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" contact\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" crm\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" postgres.data\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("postgres-data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nexus-data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("seq-data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("crm")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("network\n")])])]),a("p",[t._v("Now the file is ready, let's see "),a("code",[t._v("docker-compose")]),t._v(" in action\nFirstly, clean up environment")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" docker "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" -f postgres.data contact-api\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" docker network "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" workshop-network\n")])])]),a("p",[t._v("Secondly, run database migration")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" crm\n\n$ docker-compose -f docker-compose.yml -f docker-compose.override.yml up postgres.data contact-api-migration\n\ncontact-api-migration_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":19:09 INF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Run migration - Contact Db\ncontact-api-migration_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Master ConnectionString "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("Host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("postgres.data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("Port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5432")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("Database")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("Username")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("lab"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("Password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("********\ncontact-api-migration_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Created database crm-contact\ncontact-api-migration_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":19:11 INF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Beginning database upgrade\ncontact-api-migration_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":19:11 INF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Checking whether journal table exists"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\ncontact-api-migration_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":19:11 INF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Journal table does not exist\ncontact-api-migration_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":19:11 INF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Executing Database Server script "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script0001.sql'")]),t._v("\ncontact-api-migration_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":19:11 INF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Checking whether journal table exists"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\ncontact-api-migration_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":19:11 INF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Creating the "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"schemaversions"')]),t._v(" table\ncontact-api-migration_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":19:11 INF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" The "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"schemaversions"')]),t._v(" table has been created\ncontact-api-migration_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":19:11 INF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Upgrade successful\ncrm_contact-api-migration_1 exited with code "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\n")])])]),a("p",[t._v("It is the time to up everything.")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" crm\n\n$ docker-compose -f docker-compose.yml -f docker-compose.override.yml up postgres.data contact-api\n\nCreating network "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"crm-network"')]),t._v(" with the default driver\nCreating volume "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"crm_postgres-data"')]),t._v(" with default driver\nCreating volume "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"crm_nexus-data"')]),t._v(" with default driver\nCreating volume "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"crm_seq-data"')]),t._v(" with default driver\nCreating crm_postgres.data_1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\nCreating crm_contact-api-migration_1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\nCreating crm_contact-api_1           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"contactId"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"6c7b66fb-d8cb-493b-a2fe-96963f81e43f"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"firstName"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Ut enim ad minim veniam, quis nos"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lastName"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Duis aute irure dolor in reprehenderit in vo"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"middleName"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ipsum dolor sit amet, c"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"description"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"m"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"contactId"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"78d616a1-9e0c-4c07-a089-9d64ea551dfb"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"firstName"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ul"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lastName"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"laborum.Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incid"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"middleName"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"consequat. Duis aute irure dolor in reprehender"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"description"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magn"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("p",[t._v("Woohoo, everything is up now! Try playing around.")])])},[],!1,null,null,null);s.default=e.exports}}]);